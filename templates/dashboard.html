<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Ajouter dans <head> pour Quill.js -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <style>
    body {
      background-color: #f8f9fa;
      padding-top: 50px;
    }
    .task-done {
      text-decoration: line-through;
      color: gray;
    }
    .task-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 1rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }
    .task-buttons a {
      margin-left: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4">ğŸ‘‹ Bienvenue <strong>{{ user }}</strong></h2>

  <!-- Formulaire de crÃ©ation de tÃ¢che -->
  <form method="POST" action="/add" onsubmit="submitTask()" class="mb-4">
    <div class="mb-3">
      <input type="text" name="title" class="form-control" placeholder="Titre de la tÃ¢che" required>
    </div>

    <div class="mb-3">
      <select name="category" class="form-select">
        <option value="">ğŸ—‚ Choisir une catÃ©gorie</option>
        <option value="Facturation">Facturation</option>
        <option value="Support">Support</option>
        <option value="DÃ©veloppement">DÃ©veloppement</option>
        <!-- ... autres catÃ©gories -->
      </select>
    </div>

    <div class="mb-3">
      <select name="assigned_to" class="form-select">
        <option value="">ğŸ‘¤ Attribuer Ã </option>
        {% for u in users %}
          <option value="{{ u }}">{{ u }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Ã‰diteur Quill pour la description -->
    <div class="mb-3">
      <div id="editor" style="height: 200px;"></div>
      <input type="hidden" name="description" id="description">
    </div>

    <button type="submit" class="btn btn-primary">Ajouter la tÃ¢che</button>
  </form>

  <!-- Tri par catÃ©gorie -->
  <div class="mb-3">
    <form method="GET" action="/dashboard">
		<select name="filter" class="form-select" onchange="this.form.submit()">
		  <option value="" {% if not filter %}selected{% endif %}>ğŸ” Filtrer par catÃ©gorie</option>
		  <option value="Facturation" {% if filter == 'Facturation' %}selected{% endif %}>Facturation</option>
		  <option value="Support" {% if filter == 'Support' %}selected{% endif %}>Support</option>
		  <option value="DÃ©veloppement" {% if filter == 'DÃ©veloppement' %}selected{% endif %}>DÃ©veloppement</option>
		</select>
    </form>
  </div>

  <!-- Liste des tÃ¢ches -->
  {% for task in tasks %}
  <div class="task-item">
    <div>
      {% if task.done %}
        âœ… <span class="task-done">{{ task.title }}</span>
      {% else %}
        ğŸ”² {{ task.title }}
      {% endif %}
      <br>
      <small class="text-muted">CatÃ©gorie : {{ task.category }} | AssignÃ©e Ã  : {{ task.assigned_to }}</small>
      <div>{{ task.description|safe }}</div>
    </div>
    <div class="task-buttons">
      {% if not task.done %}
        <a href="/done/{{ task.id }}" class="btn btn-sm btn-success">âœ”ï¸</a>
      {% endif %}
      <a href="/delete/{{ task.id }}" class="btn btn-sm btn-danger">ğŸ—‘ï¸</a>
    </div>
  </div>
  {% endfor %}

  <div class="mt-4">
    <a href="/logout" class="btn btn-secondary">ğŸšª Se dÃ©connecter</a>
  </div>
</div>


  <!-- Bootstrap JS (pour modals ou composants futurs) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

<script>
  const quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: {
        container: [
          ['bold', 'italic', 'underline'],
          [{ 'header': [1, 2, 3, false] }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['image', 'code-block']
        ],
        handlers: {
          image: imageHandler
        }
      }
    }
  });

  function imageHandler() {
    const input = document.createElement('input');
    input.setAttribute('type', 'file');
    input.setAttribute('accept', 'image/*');
    input.click();

    input.onchange = () => {
      const file = input.files[0];
      if (/^image\//.test(file.type)) {
        const reader = new FileReader();
        reader.onload = () => {
          const range = quill.getSelection();
          quill.insertEmbed(range.index, 'image', reader.result);
        };
        reader.readAsDataURL(file);
      } else {
        alert("Le fichier doit Ãªtre une image.");
      }
    };
  }

  function submitTask() {
    const description = document.querySelector('input[name=description]');
    description.value = quill.root.innerHTML;
  }
</script>


</html>
